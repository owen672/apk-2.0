<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Patinaje App Móvil</title>
<meta name="theme-color" content="#0b0b0c" />
<style>
:root{
  --bg:#0b0b0c;
  --card:#121315;
  --muted:#8d8f98;
  --primary:#22c55e;
  --primary-ink:#191919;
  --success:#22c55e;
  --danger:#ef4444;
  --stroke:#232428;
  --shadow:0 10px 30px rgba(0,0,0,.35);
  --radius:16px;
}
*{box-sizing:border-box}
html,body{height:100%; margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;}
body{background:var(--bg); color:#f5f7fb;}
.app{min-height:100vh; max-width:820px; margin:0 auto; display:flex; flex-direction:column;}
header{
  position:sticky; top:0; z-index:40;
  display:flex; align-items:center; gap:.85rem; padding:14px 16px; background:rgba(10,10,11,.85);
  backdrop-filter: blur(8px); border-bottom:1px solid var(--stroke);
}
.logo{width:34px; height:34px; border-radius:12px; background:linear-gradient(135deg, var(--primary), #76e29f); color:#111; display:grid; place-items:center; font-weight:900}
.title{font-weight:800; letter-spacing:.2px}
.title small{display:block; color:var(--muted); font-weight:600; margin-top:-2px}

.screen{padding:16px; display:none;}
.screen.active{display:block}

.news-grid{display:grid; gap:12px}
.card{background:linear-gradient(180deg,#17181b,#0f1012); border:1px solid var(--stroke); border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden}
.card .media{height:140px; background:#0d0e10; display:block}
.card .media img{width:100%; height:100%; object-fit:cover}
.card .body{padding:14px}
.eyebrow{color:var(--muted); font-size:.75rem; letter-spacing:.3px; text-transform:uppercase}
.card h3{margin:6px 0 6px; font-size:1.05rem}
.card p{margin:0; color:#cfd3dc; font-size:.95rem}

.btn{appearance:none; border:none; border-radius:14px; padding:12px 14px; font-weight:800; cursor:pointer}
.btn.primary{background:linear-gradient(180deg,var(--primary),#76e29f); color:#161616}
.btn.ghost{background:#181a1d; color:#f7f9ff; border:1px solid var(--stroke)}

dialog{border:none; border-radius:18px; background:linear-gradient(180deg,#15161a,#0f1012); color:#fff; width:min(520px, 92vw); box-shadow:var(--shadow);}
dialog::backdrop{background:rgba(0,0,0,.55)}
.form{display:grid; gap:12px; padding:16px}
.field{display:grid; gap:6px}
label{font-size:.9rem; color:#e5e7ef}
input, select, textarea{width:100%; padding:12px 12px; border-radius:12px; border:1px solid var(--stroke); background:#0e0f12; color:#fff}

.tabs{display:flex; gap:8px; border-bottom:1px solid var(--stroke); margin-bottom:12px}
.tab{padding:10px 12px; border-radius:12px; border:1px solid var(--stroke); background:#121317; cursor:pointer; font-weight:700; color:#dbe0ec}
.tab.active{background:linear-gradient(180deg,#1d1f24,#111216); border-color:#2a2b31}

.profile{display:grid; gap:12px}
.chip{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; border:1px solid var(--stroke); font-size:.85rem; color:#cfd3dc}
.row{display:flex; gap:12px; flex-wrap:wrap}
.grow{flex:1 1 200px}
table{width:100%; border-collapse:collapse; background:#0f1012; border:1px solid var(--stroke); border-radius:14px; overflow:hidden}
th,td{padding:12px 10px; border-bottom:1px solid var(--stroke); text-align:left}
th{background:#131419}
.status{font-weight:900; padding:6px 10px; border-radius:999px; display:inline-block}
.paid{background:rgba(34,197,94,.15); color:#86efac; border:1px solid rgba(34,197,94,.35)}
.due{background:rgba(239,68,68,.15); color:#fecaca; border:1px solid rgba(239,68,68,.35)}
.pending{background:rgba(253,224,71,.15); color:#fef08a; border:1px solid rgba(253,224,71,.35)}
.footer-space{height:18vh}
.right{justify-self:end}
.divider{height:1px; background:var(--stroke); margin:8px 0}
.muted{color:var(--muted)}
.center{text-align:center}
.hidden{display:none !important}

/* BOTÓN FLOTANTE */
#floatingBtnContainer {position:fixed; bottom:24px; right:24px; z-index:50;}
#floatingBtn {width:56px; height:56px; border-radius:50%; font-size:28px; background:var(--primary); color:#111; border:none; cursor:pointer; box-shadow:var(--shadow);}
#floatingMenu {display:flex; flex-direction:column; gap:8px; margin-top:8px;}
</style>
</head>
<body>
<div class="app" id="app">
<header>
  <div class="logo">⛸️</div>
  <div class="title">Patinaje LAT App <small class="muted">Noticias • Tiempos • Pagos</small></div>
  <button id="logoutBtn" class="btn ghost right hidden" title="Cerrar sesión">Salir</button>
</header>

<!-- NOTICIAS / LANDING -->
<section id="newsScreen" class="screen active">
  <h2 style="margin:6px 0 12px">Noticias de Patinaje</h2>
  <p class="muted" style="margin-top:-6px">Resumen rápido pensado para móvil.</p>
  <div id="newsList" class="news-grid"></div>
</section>

<!-- DASHBOARD -->
<section id="dashboard" class="screen">
  <h2>Bienvenido <span id="userName"></span></h2>
  <div class="tabs" role="tablist">
    <button class="tab active" data-tab="perfil">Perfil</button>
    <button class="tab" data-tab="tiempos">Tiempos</button>
    <button class="tab" data-tab="pagos">Pagos</button>
    <button class="tab" data-tab="comentarios">Comentarios</button>
  </div>
  <div id="tab-perfil" class="tabpanel">
    <div class="row">
      <div class="card grow">
        <div class="body" id="perfilBody"></div>
      </div>
    </div>
  </div>
  <div id="tab-tiempos" class="tabpanel hidden">
    <div class="card">
      <div class="body">
        <div class="row" style="align-items:end">
          <div class="grow">
            <label class="muted">Distancia</label>
            <input id="distInput" placeholder="200m / 400m / 1km" />
          </div>
          <div class="grow">
            <label class="muted">Tiempo (mm:ss.ms)</label>
            <input id="timeInput" placeholder="00:28.45" />
          </div>
          <button class="btn ghost" id="addTime">Agregar</button>
        </div>
      </div>
    </div>
    <div class="card" style="margin-top:12px">
      <div class="body">
        <h3 style="margin-top:0">Tabla de mejores tiempos</h3>
        <table id="timesTable">
          <thead><tr><th>Distancia</th><th>Mejor tiempo</th><th>Fecha</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>
  <div id="tab-pagos" class="tabpanel hidden">
    <div class="card">
      <div class="body">
        <div class="row" style="align-items:center">
          <div class="grow">
            <h3 style="margin:0">Estado de pago</h3>
            <div id="payStatus" class="status pending">Pendiente</div>
            <p class="muted" id="payNote" style="margin-top:8px">Sube el comprobante o marca como pagado.</p>
          </div>
          <select id="payState">
            <option value="pending">Pendiente</option>
            <option value="paid">Pagado</option>
            <option value="due">En mora</option>
          </select>
        </div>
        <div class="row" style="margin-top:10px">
          <input type="file" id="payReceipt" accept="image/*,application/pdf" class="grow" />
          <button class="btn ghost" id="savePayment">Guardar</button>
        </div>
      </div>
    </div>
  </div>
  <div id="tab-comentarios" class="tabpanel hidden">
    <div class="card">
      <div class="body">
        <div id="commentsList" class="profile" style="max-height:40vh; overflow:auto"></div>
        <div class="divider"></div>
        <div class="row">
          <input id="commentInput" class="grow" placeholder="Comentario del profesor..." />
          <button class="btn primary" id="addComment">Agregar</button>
        </div>
      </div>
    </div>
  </div>
  <div class="footer-space"></div>
</section>

<!-- BOTÓN FLOTANTE -->
<div id="floatingBtnContainer">
  <button id="floatingBtn" class="btn primary">+</button>
  <div id="floatingMenu" class="hidden">
    <button class="btn ghost" id="regBtn">Registro</button>
    <button class="btn ghost" id="loginBtn">Iniciar sesión</button>
  </div>
</div>

<!-- DIALOGO TIPO DE USUARIO -->
<dialog id="userTypeDialog">
  <form method="dialog" class="form" id="userTypeForm">
    <h3>Seleccione tipo de usuario</h3>
    <div class="field">
      <button type="button" class="btn ghost" data-type="athlete">Deportista</button>
      <button type="button" class="btn ghost" data-type="trainer">Entrenador</button>
      <button type="button" class="btn ghost" data-type="admin">Administrativo</button>
    </div>
    <menu>
      <button class="btn ghost" id="cancelUserType">Cancelar</button>
    </menu>
  </form>
</dialog>

<!-- DIALOGOS REGISTRO Y LOGIN -->
<dialog id="dlgRegister">
  <form method="dialog" class="form" id="registerForm">
    <h3>Registro</h3>
    <div class="field">
      <label>Nombre</label>
      <input type="text" id="regName" required />
    </div>
    <div class="field">
      <label>Contraseña</label>
      <input type="password" id="regPass" required />
    </div>
    <menu>
      <button class="btn ghost" id="cancelReg">Cancelar</button>
      <button class="btn primary" id="submitReg">Registrar</button>
    </menu>
  </form>
</dialog>

<dialog id="dlgLogin">
  <form method="dialog" class="form" id="loginForm">
    <h3>Iniciar sesión</h3>
    <div class="field">
      <label>Nombre</label>
      <input type="text" id="loginName" required />
    </div>
    <div class="field">
      <label>Contraseña</label>
      <input type="password" id="loginPass" required />
    </div>
    <menu>
      <button class="btn ghost" id="cancelLogin">Cancelar</button>
      <button class="btn primary" id="submitLogin">Ingresar</button>
    </menu>
  </form>
</dialog>

<script>
// ===== Noticias demo =====
const newsList = document.getElementById('newsList');
const noticiasDemo = [
  {title:"Copa Tintal 2025 se acerca", desc:"Todo listo para la gran competencia.", img:"https://picsum.photos/300/140?1"},
  {title:"Entrenamientos intensivos", desc:"Nuevos programas de preparación.", img:"https://picsum.photos/300/140?2"},
  {title:"Patinaje sobre ruedas", desc:"Tips para mejorar velocidad y técnica.", img:"https://picsum.photos/300/140?3"},
];
noticiasDemo.forEach(n => {
  const card = document.createElement('div'); card.className='card';
  card.innerHTML=`<div class="media"><img src="${n.img}"/></div>
  <div class="body"><h3>${n.title}</h3><p>${n.desc}</p></div>`;
  newsList.appendChild(card);
});

// ===== Floating btn =====
const floatingBtn = document.getElementById('floatingBtn');
const floatingMenu = document.getElementById('floatingMenu');
floatingBtn.onclick = () => floatingMenu.classList.toggle('hidden');

const userTypeDialog = document.getElementById('userTypeDialog');
let selectedAction = null;

document.getElementById('regBtn').onclick = () => { 
  selectedAction = 'register'; 
  floatingMenu.classList.add('hidden');
  userTypeDialog.showModal();
};
document.getElementById('loginBtn').onclick = () => { 
  selectedAction = 'login'; 
  floatingMenu.classList.add('hidden');
  userTypeDialog.showModal();
};

// ====== LocalStorage ======
let athletes = JSON.parse(localStorage.getItem('athletes')||'[]');
let trainers = JSON.parse(localStorage.getItem('trainers')||'[]');
let admins = JSON.parse(localStorage.getItem('admins')||'[]');
let currentUser = null, currentRole = null;

// ===== Dialog tipo usuario =====
userTypeDialog.querySelectorAll('button[data-type]').forEach(b=>{
  b.onclick = ()=>{
    const type = b.dataset.type;
    userTypeDialog.close();
    if(selectedAction==='register') dlgRegister.showModal(), dlgRegister.dataset.type=type;
    if(selectedAction==='login') dlgLogin.showModal(), dlgLogin.dataset.type=type;
  }
});
document.getElementById('cancelUserType').onclick = ()=>userTypeDialog.close();

// ===== Registro =====
const dlgRegisterEl = document.getElementById('dlgRegister');
document.getElementById('cancelReg').onclick=()=>dlgRegisterEl.close();
document.getElementById('submitReg').onclick=(e)=>{
  e.preventDefault();
  const name = document.getElementById('regName').value.trim();
  const pass = document.getElementById('regPass').value.trim();
  const type = dlgRegisterEl.dataset.type;
  if(!name||!pass){alert('Complete todos los campos'); return;}
  let arr;
  if(type==='athlete') arr=athletes;
  else if(type==='trainer') arr=trainers;
  else arr=admins;
  if(arr.find(u=>u.name===name)){alert('Ya existe'); return;}
  arr.push({name,pass,times:[],payments:{state:'pending'},comments:[]});
  localStorage.setItem(type+'s', JSON.stringify(arr));
  alert('Registrado con éxito');
  dlgRegisterEl.close();
};

// ===== Login =====
const dlgLoginEl = document.getElementById('dlgLogin');
document.getElementById('cancelLogin').onclick=()=>dlgLoginEl.close();
document.getElementById('submitLogin').onclick=(e)=>{
  e.preventDefault();
  const name = document.getElementById('loginName').value.trim();
  const pass = document.getElementById('loginPass').value.trim();
  const type = dlgLoginEl.dataset.type;
  let arr;
  if(type==='athlete') arr=athletes;
  else if(type==='trainer') arr=trainers;
  else arr=admins;
  const user = arr.find(u=>u.name===name && u.pass===pass);
  if(!user){alert('Usuario o contraseña incorrecta'); return;}
  currentUser = user; currentRole = type;
  dlgLoginEl.close();
  showDashboard();
};

// ===== Dashboard =====
const newsScreen = document.getElementById('newsScreen');
const dashboard = document.getElementById('dashboard');
const logoutBtn = document.getElementById('logoutBtn');
const tabs=document.querySelectorAll('.tab');
tabs.forEach(t=>{
  t.onclick=()=>{
    tabs.forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    document.querySelectorAll('.tabpanel').forEach(p=>p.classList.add('hidden'));
    document.getElementById('tab-'+t.dataset.tab).classList.remove('hidden');
  }
});
logoutBtn.onclick=()=>{
  currentUser=null; currentRole=null;
  dashboard.classList.remove('active'); newsScreen.classList.add('active');
  logoutBtn.classList.add('hidden');
};

// ===== Mostrar dashboard =====
function showDashboard(){
  newsScreen.classList.remove('active'); dashboard.classList.add('active');
  logoutBtn.classList.remove('hidden');
  document.getElementById('userName').textContent=currentUser.name;
  renderPerfil();
  renderTimes();
}

// ===== Perfil =====
function renderPerfil(){
  const div=document.getElementById('perfilBody');
  div.innerHTML=`<h3>Rol: ${currentRole}</h3><p>Nombre: ${currentUser.name}</p>`;
}

// ===== Tiempos =====
const addTimeBtn=document.getElementById('addTime');
addTimeBtn.onclick=()=>{
  const dist=document.getElementById('distInput').value.trim();
  const time=document.getElementById('timeInput').value.trim();
  if(!dist||!time){alert('Complete distancia y tiempo'); return;}
  currentUser.times.push({dist,time,date:new Date().toLocaleString()});
  saveCurrentUser();
  renderTimes();
};
function renderTimes(){
  const tbody=document.querySelector('#timesTable tbody');
  tbody.innerHTML='';
  if(!currentUser.times) return;
  currentUser.times.forEach((t,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${t.dist}</td><td>${t.time}</td><td>${t.date}</td><td><button class="btn ghost" onclick="deleteTime(${i})">Eliminar</button></td>`;
    tbody.appendChild(tr);
  });
}
window.deleteTime=(i)=>{
  currentUser.times.splice(i,1);
  saveCurrentUser();
  renderTimes();
};
function saveCurrentUser(){
  let arr;
  if(currentRole==='athlete') arr=athletes;
  else if(currentRole==='trainer') arr=trainers;
  else arr=admins;
  const idx=arr.findIndex(u=>u.name===currentUser.name);
  if(idx>-1){arr[idx]=currentUser;}
  localStorage.setItem(currentRole+'s', JSON.stringify(arr));
}

</script>
</body>
</html>
